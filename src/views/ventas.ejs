<link rel="shortcut icon"
  href="https://ajeetchaulagain.com/static/7cb4af597964b0911fe71cb2f8148d64/87351/express-js.png" type="image/x-icon" />
<%- include('./layouts/nav') %>
  <h1>Listado de Ventas</h1>
  <button id="agregarVentaBtn">Agregar</button>

  <!-- Modal -->
  <div id="agregarVentaModal" class="modal">
    <div class="modal-content">
      <span id="cerrarModal" class="cerrar">&times;</span>
      <h2>Agregar Venta</h2>

      <!-- Formulario para agregar venta -->
      <form id="formularioAgregarVenta" action="/agregarVenta" method="POST">

        <label for="metodoPago">Método de Pago:</label>
        <select id="metodoPago" name="metodo_pago" required>
          <option value="Efectivo">Efectivo</option>
          <option value="Tarjeta de Crédito">Tarjeta de Crédito</option>
          <option value="Transferencia Bancaria">Transferencia Bancaria</option>
        </select>

        <label for="totalVenta">Total Venta:</label>
        <input type="number" id="totalVenta" name="total_venta" required>

        <label for="pedido">Pedido:</label>
        <select id="pedido" name="pedido">
          <% pedidos.forEach(pedido=> { %>
            <% if (pedido.estado_pedido==="completado" ) { %>
              <option value="<%= pedido._id %>">
                <%= pedido.nombre_usuario %>, total= <%= pedido.total_pedido %>
              </option>
              <% } %>
                <% }); %>
        </select>

        <label for="usuario">Usuario:</label>
        <select id="usuario" name="usuario">
          <% usuarios.forEach(usuario=> { %>
            <option value="<%= usuario._id %>">
              <%= usuario.nombre%>
            </option>
            <% }); %>
        </select>

        <!-- Otros campos según la estructura de tu venta -->

        <button type="submit">Guardar Venta</button>
      </form>
    </div>
  </div>

  <!-- Dentro del código HTML -->
  <input type="text" id="searchInput" placeholder="Buscar ventas...">
  <button onclick="buscarVentas()">Buscar</button>




  <table>
    <thead>
      <tr>
        <td>Fecha Venta</td>
        <td>Método Pago</td>
        <td>Total Venta</td>
        <td>Total Pedido</td>
        <td>Nombre</td>
        <td>Teléfono</td>
        <td>Documento</td>
        <td>Correo</td>
        <td>Acción</td>
      </tr>
    </thead>
    <tbody>
      <% ventas.forEach(venta=> { %>
        <tr>
          <td>
            <%= venta.fecha_venta %>
          </td>
          <td>
            <%= venta.metodo_pago %>
          </td>
          <td>
            <%= venta.total_venta %>
          </td>
          <td>
            <%= venta.total_pedido %>
          </td>
          <td>
            <%= venta.nombre %>
          </td>
          <td>
            <%= venta.telefono %>
          </td>
          <td>
            <%= venta.documento %>
          </td>
          <td>
            <%= venta.correo %>
          </td>
          <td>
            <button
              onclick="mostrarDetalle('<%= JSON.stringify(venta.productos) %>', '<%= JSON.stringify(venta.servicios) %>')">Ver
              Detalle</button>
          </td>
          <td>
            <a href="/editarVenta/<%= venta._id %>">
              <button>Editar</button>
            </a>
          </td>
          <td>
            <a href="#" onclick="confirmarEliminar('<%= venta._id %>')">Eliminar</a>
          </td>
        </tr>
        <% }); %>
    </tbody>
  </table>
  <!-- Agrega un botón para generar el reporte -->
  <button onclick="generarReporteBtn()">Generar Reporte</button>


  <script>
    function generarReporteBtn() {
      window.location.href = '/generarReporte';
    }

    function confirmarEliminar(idVenta) {
      // Muestra una alerta para confirmar la eliminación
      const confirmacion = confirm('¿Seguro que desea eliminar?');

      // Si el usuario confirma la eliminación
      if (confirmacion) {
        // Redirige a la página de eliminación con el ID de la venta
        window.location.href = `/eliminarVenta/${idVenta}`;
      } else {
        // Si el usuario cancela, no hace nada o puedes realizar alguna acción adicional
      }
    }

    <!-- Resto del código HTML anterior -->


    function mostrarDetalle(productosJSON, serviciosJSON) {
      const productos = JSON.parse(productosJSON);
      const servicios = JSON.parse(serviciosJSON);

      let detalleProductos = 'Productos: ';
      productos.forEach((producto, index) => {
        detalleProductos += `${producto.nombreProducto}: Precio: ${producto.precioProducto}`;
        if (index !== productos.length - 1) {
          detalleProductos += ', ';
        }
      });

      let detalleServicios = 'Servicios: ';
      servicios.forEach((servicio, index) => {
        detalleServicios += `${servicio.nombreServicio}: Precio: ${servicio.precioServicio}`;
        if (index !== servicios.length - 1) {
          detalleServicios += ', ';
        }
      });

      alert(detalleProductos + '\n' + detalleServicios);
    }


    // JavaScript para mostrar/ocultar el modal y cerrar el modal
    const agregarVentaBtn = document.getElementById('agregarVentaBtn');
    const agregarVentaModal = document.getElementById('agregarVentaModal');
    const cerrarModal = document.getElementById('cerrarModal');
    const formularioAgregarVenta = document.getElementById('formularioAgregarVenta');

    agregarVentaBtn.addEventListener('click', () => {
      agregarVentaModal.style.display = 'block';
    });

    cerrarModal.addEventListener('click', () => {
      agregarVentaModal.style.display = 'none';
    });


    // JavaScript para la funcionalidad de búsqueda
    function buscarVentas() {
      const input = document.getElementById('searchInput');
      const filter = input.value.toUpperCase();
      const table = document.querySelector('table');
      const rows = table.getElementsByTagName('tr');

      for (let i = 0; i < rows.length; i++) {
        const cells = rows[i].getElementsByTagName('td');
        let found = false;

        for (let j = 0; j < cells.length; j++) {
          const cell = cells[j];
          if (cell) {
            if (cell.innerHTML.toUpperCase().indexOf(filter) > -1) {
              found = true;
              break;
            }
          }
        }

        if (found) {
          rows[i].style.display = '';
        } else {
          rows[i].style.display = 'none';
        }
      }
    }



  </script>