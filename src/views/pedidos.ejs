<!-- src/views/pedidos.ejs -->
<link rel="shortcut icon"
  href="https://ajeetchaulagain.com/static/7cb4af597964b0911fe71cb2f8148d64/87351/express-js.png" type="image/x-icon" />
<%- include('./layouts/nav') %>
<h1>Lista de usuarios</h1>
<ul>
  <% usuarios.forEach(usuario=> { %>
    <li>
      <%= usuario.nombre %>
    </li>
  <% }); %>
</ul>

<div id="agregarPedidoModal" class="modal" style="display: none;">
  <div class="modal-content">
    <span id="cerrarModal" class="cerrar">&times;</span>
    <h2>Agregar Pedido</h2>
    <!-- Tu formulario para agregar pedidos aquí -->
    <form id="formularioAgregarPedido" action="/agregarPedido" method="POST">
      <label for="fechaPedido">Fecha pedido:</label>
      <input type="date" id="fechaPedido" name="fechaPedido" min="<%= fechaActual %>" required>

      <!-- Campos para agregar servicios -->
      <div id="serviciosContainer">
        <h3>Servicios</h3>
        <div class="servicio">
          <label for="tipoServicio">Tipo de Servicio:</label>
          <select id="tipoServicio" name="tipoServicio" required>
            <option value="tipo1">Tipo 1</option>
            <option value="tipo2">Tipo 2</option>
            <option value="tipo3">Tipo 3</option>
          </select>

          <!-- Otros campos del servicio -->
          <label for="nombreServicio">Nombre Servicio:</label>
          <input type="text" id="nombreServicio" name="nombreServicio" required>

          <!-- Otros campos del servicio -->
          <!-- ... (agrega aquí los campos que faltan) -->

          <button type="button" onclick="agregarServicio()">Agregar Servicio</button>
        </div>
      </div>

      <!-- Campos para agregar productos -->
      <div id="productosContainer">
        <h3>Productos</h3>
        <div class="producto">
          <label for="tipoProducto">Tipo de Producto:</label>
          <select id="tipoProducto" name="tipoProducto" required>
            <option value="tipo1">Tipo 1</option>
            <option value="tipo2">Tipo 2</option>
            <option value="tipo3">Tipo 3</option>
          </select>

          <!-- Otros campos del producto -->
          <label for="nombreProducto">Nombre Producto:</label>
          <input type="text" id="nombreProducto" name="nombreProducto" required>

          <!-- Otros campos del producto -->
          <!-- ... (agrega aquí los campos que faltan) -->

          <button type="button" onclick="agregarProducto()">Agregar Producto</button>
        </div>
      </div>

      <label for="nombreUsuario">Nombre Usuario:</label>
      <select id="nombreUsuario" name="nombreUsuario" required>
        <% usuarios.forEach(usuario => { %>
          <option value="<%= usuario.nombre %>"><%= usuario.nombre %></option>
        <% }); %>
      </select>

      <button type="submit">Guardar Pedido</button>
    </form>
  </div>
</div>
<h1>Listado de Pedidos</h1>
<button id="agregarPedidoBtn">Agregar</button>

<!-- Modal -->

<table>
  <thead>
    <tr>
      <td>Fecha Creacion</td>
      <td>Fecha Pedido</td>
      <td>Total</td>
      <td>Estado</td>
      <td>Usuario</td>
      <td>Acción</td>
    </tr>
  </thead>
  <tbody>
    <% pedidos.forEach(pedido => { %>
      <tr>
        <td><%= pedido.fecha_creacion %></td>
        <td><%= pedido.fecha_pedido %></td>
        <td><%= pedido.total_pedido %></td>
        <td><%= pedido.estado_pedido %></td>
        <td><%= pedido.nombre_usuario %></td>
        <td>editar &nbsp; <a href="/eliminarPedido/<%= pedido._id %>">Eliminar</a></td>
      </tr>
    <% }); %>
  </tbody>
</table>

<script>
  // JavaScript para mostrar/ocultar el modal y validar fechas
  const agregarPedidoBtn = document.getElementById('agregarPedidoBtn');
  const agregarPedidoModal = document.getElementById('agregarPedidoModal');
  const cerrarModal = document.getElementById('cerrarModal');
  const formularioAgregarPedido = document.getElementById('formularioAgregarPedido');
  const fechaPedidoInput = document.getElementById('fechaPedido');
  let servicioCount = 1; // Contador para servicios
  let productoCount = 1; // Contador para productos

  agregarPedidoBtn.addEventListener('click', () => {
    agregarPedidoModal.style.display = 'block';
  });

  cerrarModal.addEventListener('click', () => {
    agregarPedidoModal.style.display = 'none';
  });

  formularioAgregarPedido.addEventListener('submit', (event) => {
    const fechaCreacion = "<%= fechaActual %>"; // Obtén la fecha de creación del servidor
    const fechaPedido = fechaPedidoInput.value;

    if (fechaPedido < fechaCreacion) {
      alert('La fecha de pedido no puede ser anterior a la fecha de creación.');
      event.preventDefault(); // Evita el envío del formulario si la fecha es incorrecta
    } else {
      agregarPedidoModal.style.display = 'none';
      // Aquí puedes agregar la lógica para enviar el formulario o realizar acciones con los datos ingresados
    }
  });

  // Función para agregar dinámicamente campos de servicio
  const agregarServicio = () => {
    servicioCount++;
    const serviciosContainer = document.getElementById('serviciosContainer');
    const nuevoServicio = document.createElement('div');
    nuevoServicio.classList.add('servicio');
    nuevoServicio.innerHTML = `
      <label for="tipoServicio${servicioCount}">Tipo de Servicio:</label>
      <select id="tipoServicio${servicioCount}" name="tipoServicio" required>
        <option value="tipo1">Tipo 1</option>
        <option value="tipo2">Tipo 2</option>
        <option value="tipo3">Tipo 3</option>
      </select>

      <!-- Otros campos del servicio -->
      <label for="nombreServicio${servicioCount}">Nombre Servicio:</label>
      <input type="text" id="nombreServicio${servicioCount}" name="nombreServicio" required>

      <!-- Otros campos del servicio -->
      <!-- ... (agrega aquí los campos que faltan) -->
    `;
    serviciosContainer.appendChild(nuevoServicio);
  };

  // Función para agregar dinámicamente campos de producto
  const agregarProducto = () => {
    productoCount++;
    const productosContainer = document.getElementById('productosContainer');
    const nuevoProducto = document.createElement('div');
    nuevoProducto.classList.add('producto');
    nuevoProducto.innerHTML = `
      <label for="tipoProducto${productoCount}">Tipo de Producto:</label>
      <select id="tipoProducto${productoCount}" name="tipoProducto" required>
        <option value="tipo1">Tipo 1</option>
        <option value="tipo2">Tipo 2</option>
        <option value="tipo3">Tipo 3</option>
      </select>

      <!-- Otros campos del producto -->
      <label for="nombreProducto${productoCount}">Nombre Producto:</label>
      <input type="text" id="nombreProducto${productoCount}" name="nombreProducto" required>

      <!-- Otros campos del producto -->
      <!-- ... (agrega aquí los campos que faltan) -->
    `;
    productosContainer.appendChild(nuevoProducto);
  };
</script>
